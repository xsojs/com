(function(s,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(s=typeof globalThis<"u"?globalThis:s||self,s.com=h())})(this,function(){var tt,_,I,R,F,D,k,J,q,x,H,y,X,z,ut,B,N,$,d,T,v,C,U,P,G,Q,a,M,A,et,wt,nt,Ct,it,Ot,W,ht;"use strict";var jt=Object.defineProperty;var kt=(s,h,f)=>h in s?jt(s,h,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[h]=f;var gt=(s,h,f)=>(kt(s,typeof h!="symbol"?h+"":h,f),f),lt=(s,h,f)=>{if(!h.has(s))throw TypeError("Cannot "+f)};var n=(s,h,f)=>(lt(s,h,"read from private field"),f?f.call(s):h.get(s)),u=(s,h,f)=>{if(h.has(s))throw TypeError("Cannot add the same private member more than once");h instanceof WeakSet?h.add(s):h.set(s,f)},c=(s,h,f,m)=>(lt(s,h,"write to private field"),m?m.call(s,f):h.set(s,f),f);var E=(s,h,f)=>(lt(s,h,"access private method"),f);function s(e,t,r,l){if(s.null==t)throw new Error(`${r} is null and not a valid ${e}.`);if(s.invalid==t)throw new Error(`${r} is ${typeof l} and not a valid ${e}.`)}s.array="array",s.function="function",s.object="object",s.string="string",s.null=0,s.invalid=1;function h(e,t){t==null&&s(s.array,s.null,e,t),(typeof t!="object"||!Array.isArray(t))&&s(s.array,s.invalid,e,t)}function f(e,t){t==null&&s(s.function,s.null,e,t),typeof t!="function"&&s(s.function,s.invalid,e,t)}function m(e,t){t==null&&s(s.object,s.null,e,t),(typeof t!="object"||Array.isArray(t))&&s(s.object,s.invalid,e,t)}function Y(e,t){t==null&&s(s.string,s.null,e,t),typeof t!="string"&&!(t instanceof String)&&s(s.string,s.invalid,e,t)}function K(e){return typeof e=="object"&&e!=null&&Array.isArray(e)}function vt(e){return typeof e=="function"&&e!=null}function Z(e){return typeof e=="object"&&e!=null&&!Array.isArray(e)}function V(e){return(typeof e=="string"||e instanceof String)&&e!=null}const ct=[],ft="_xso_com_",g={COMPONENTS:ct,COMPONENTS_PREFIX:ft,getComponent:e=>ct.find(t=>t.key==e).instance,isKey:e=>e.indexOf(ft)==0};class st{constructor(t,r){u(this,tt,null);u(this,_,null);u(this,I,null);u(this,R,null);c(this,tt,t),c(this,_,r)}get current(){return n(this,R)}set current(t){c(this,R,t),n(this,_).fire(this)}set(t){return c(this,I,t),this}get(){return n(this,I)}}tt=new WeakMap,_=new WeakMap,I=new WeakMap,R=new WeakMap,st.prototype.toString=function(){return this.current};function bt(e,t,r){m("Properties",t);const l=o=>new Error(`Content of type ${typeof o} is not valid, only string, object, or array with objects.`);for(const o of Object.keys(t)){const i=t[o];if(o=="_"&&i)if(V(i))e.textContent=i;else if(K(i))S(e,i,r);else if(Z(i))S(e,[i],r);else throw l(i);else if(o=="$"&&i)if(V(i))e.innerHTML=i;else if(K(i))S(e,i,r,!0);else if(Z(i))S(e,[i],r,!0);else throw l(i);else if(o=="text"&&i)Y(o,i),e.innerText=i;else if(o=="html"&&i)Y(o,i),e.innerHTML=i;else if(o=="style"&&i){m(o,i);for(const p of Object.keys(i))e.style[p]=i[p]}else if(o=="className"&&i)Y(o,i),e.className=i;else if(o=="classList"&&i)at(e,i);else if(o=="class"&&i){if(V(i))e.className=i;else if(K(i))at(e,i);else if(i!=null&&i!=null)throw new Error(`CSS Class of type ${typeof i} is not valid, only string or array of strings is accepted.`)}else o.indexOf("on")==0?(f(o,i),e.addEventListener(o.substring(2).toLowerCase(),i)):e.setAttribute(o,i)}}function at(e,t){h(key,t);for(const r of t)Y(r),e.classList.add(r)}function S(e,t,r,l){const o=[];if(Z(t))if(t instanceof st){const i=S(e,t.get(),r);if(i.length==0)throw new Error("Reference is empty with no valid elements.");if(i.length>1)throw new Error("Reference with more than 1 element.");t.current=i[0]}else{const i=Object.keys(t);if(i.length>1)throw new Error(`Object with more than 1 keys: ${i.join(", ")}`);if(i.length==0)throw new Error("Object with no key, but one is required.");for(const p of i){const O=t[p];if(g.isKey(p)){const b=g.getComponent(p).clone();b.parent=e,b.render(O),r&&r.appendChildComponent(b),o.push(b)}else{const b=document.createElement(p);bt(b,O,r),o.push(b),e.appendChild(b)}}}else if(K(t))for(const i of t)if(V(i))if(l){const p=document.createElement("span");p.innerHTML=i,e.appendChild(p),o.push(i)}else{const p=document.createTextNode(i);e.appendChild(p),o.push(i)}else S(e,i,r);else throw new Error(`View of type ${typeof t} is invalid, only object or array of objects.`);return o}class pt{constructor(t,r){u(this,F,null);u(this,D,null);u(this,k,null);u(this,J,null);c(this,F,t),c(this,k,r)}set val(t){JSON.stringify(n(this,J))!=JSON.stringify(t)&&(c(this,D,n(this,k)),c(this,k,t),c(this,J,JSON.stringify(t)),console.log("Props >> "+n(this,F).key(),t))}get val(){return n(this,k)}get previous(){return n(this,D)}}F=new WeakMap,D=new WeakMap,k=new WeakMap,J=new WeakMap,pt.prototype.toString=function(){return this.val};class dt{constructor(t,r,l){u(this,z);u(this,q,null);u(this,x,null);u(this,H,null);u(this,y,null);u(this,X,0);c(this,q,t),c(this,x,r),c(this,y,l)}set $val(t){n(this,y)!==t&&(E(this,z,ut).call(this,t),n(this,q).render(),n(this,x).fire(this))}get $val(){return n(this,y)}set val(t){n(this,y)!==t&&(E(this,z,ut).call(this,t),n(this,x).fire(this))}get val(){return n(this,y)}get previous(){return n(this,H)}get lastChanged(){return n(this,X)}}q=new WeakMap,x=new WeakMap,H=new WeakMap,y=new WeakMap,X=new WeakMap,z=new WeakSet,ut=function(t){c(this,H,n(this,y)),c(this,y,t),c(this,X,Date.now())},dt.prototype.toString=function(){return this.val};class Et{constructor(){u(this,B,[]);u(this,N,[])}add(t,r){n(this,B).push({items:t,func:r})}fire(t){const r=n(this,B).filter(l=>l.items.includes(t));for(const l of r)l&&!n(this,N).includes(l.func)&&(n(this,N).push(l.func),setTimeout(()=>{n(this,N).splice(n(this,N).indexOf(l.func),1),l.func()},0))}}B=new WeakMap,N=new WeakMap;function yt(e){return e instanceof w}function rt(e){if(!yt(e))throw new Error("Invalid component, because not implement the component class.")}const ot=class{constructor(t){u(this,et);u(this,nt);u(this,it);u(this,W);u(this,$,!1);u(this,d,null);u(this,T,null);u(this,v,null);u(this,C,null);u(this,U,[]);u(this,P,()=>{});u(this,G,()=>{});u(this,Q,()=>{});u(this,a,{elements:[],components:[]});u(this,M,new Et);gt(this,"parent",null);u(this,A,null);if(!vt(t)||t.toString().indexOf("function")!=0)throw new Error("Only classic functions are used for components and arrow function is not supported.");c(this,d,t),E(this,et,wt).call(this)}name(){return n(this,d).name}clone(){return new ot(n(this,d))}childrenElements(){return[...n(this,a).elements]}childrenComponents(){return[...n(this,a).components]}appendChildComponent(t){rt(t),n(this,a).components.push(t)}mount(t){t?c(this,P,t):n(this,P).call(this)}unmount(t){t?c(this,G,t):(E(this,it,Ot).call(this),E(this,nt,Ct).call(this),n(this,G).call(this))}view(t){c(this,Q,t)}ref(){return new st(this,n(this,M))}changes(t,r){n(this,M).add(t,r)}render(t){var l;const r=this;n(this,v)?(n(this,A)&&clearTimeout(n(this,A)),c(this,A,setTimeout(()=>{var o;E(o=r,W,ht).call(o,t)},0))):E(l=r,W,ht).call(l,t)}static isSameKind(t,r){let l=null;for(const i of Object.keys(t))l=i;const o=g.getComponent(l);return n(o,d)===n(r,d)}function(){return n(this,d)}key(){return n(this,T)}destroy(){const t=g.COMPONENTS.findIndex(r=>r.key==n(this,T));g.COMPONENTS.splice(t,1)}state(t){if(n(this,C))return n(this,U)[n(this,C).state++];const r=new dt(this,n(this,M),t);return n(this,U).push(r),r}};let w=ot;$=new WeakMap,d=new WeakMap,T=new WeakMap,v=new WeakMap,C=new WeakMap,U=new WeakMap,P=new WeakMap,G=new WeakMap,Q=new WeakMap,a=new WeakMap,M=new WeakMap,A=new WeakMap,et=new WeakSet,wt=function(){for(;;){const t=g.COMPONENTS_PREFIX+"["+n(this,d).name+"]_"+(Math.random()+1).toString(36).substring(2);if(!g.COMPONENTS.find(r=>r.key==t)){c(this,T,t);break}}g.COMPONENTS.push({key:n(this,T),instance:this})},nt=new WeakSet,Ct=function(){if(n(this,a).elements.length>0){if(parent=n(this,a).elements[0].parentNode,parent==null)return;for(const t of n(this,a).elements)parent.contains(t)&&parent.removeChild(t)}},it=new WeakSet,Ot=function(){for(const t of n(this,a).components)t.unmount();n(this,a).components=[]},W=new WeakSet,ht=function(t){n(this,v)?t?n(this,v).val=t:c(this,C,{state:0}):c(this,v,new pt(this,t)),n(this,$)==!1&&n(this,d).bind(this)(n(this,v).val);let r=n(this,Q).bind(this)();(!r||r.length==0)&&(r=[{span:{style:{display:"none"}}}]);let l=null;n(this,C)&&(l=n(this,a).elements[0].parentNode);const o=document.createDocumentFragment(),i=n(this,a).components;if(n(this,a).components=[],S(o,r,this),n(this,C)){const p=[];for(const O of o.children)p.push(O);if(n(this,a).elements.length==0)this.parent.appendChild(o);else{l.insertBefore(o,n(this,a).elements[0]);for(const O of i)O.unmount();for(const O of n(this,a).elements)l.contains(O)&&l.removeChild(O)}n(this,a).elements=p}else{for(const p of o.children)n(this,a).elements.push(p);this.parent.appendChild(o)}c(this,C,null),n(this,$)==!1&&(c(this,$,!0),n(this,P)&&window.setTimeout(n(this,P),0))},w.prototype.toString=function(){return this.key()},w.prototype.isSameKind=function(e,t){return w.isSameKind(e,t)};function St(e){m("Component Props",e);let t=null;for(const r of Object.keys(e)){if(t!=null)throw new Error(`More than 1 component in the same object: ${e}`);t=e[r],m("Component Props Loaded",t)}return t}function mt(e){m("jsonDefinition of an invalid object.",e);let t=null;for(const l of Object.keys(e))t=l;let r=t;return t.indexOf(g.COMPONENTS_PREFIX)==0&&(r=t.substring(t.indexOf("[")+1,t.lastIndexOf("]"))),JSON.stringify({[r]:e[t]})}function L(e,t){const r=l=>new Error(`Only ${t.function().name} type is accepted! This component is invalid: ${mt(l)}`);if(K(e)){for(const l of e)if(m("ensureSameKind of an invalid object.",l),!w.isSameKind(l,t))throw r(l)}else if(Z(e)){if(!w.isSameKind(e,t))throw r(e)}else throw new Error("Invalid kind.")}L.required=(e,t)=>{if(e)return L(e,t);throw new Error(`${t.name()} is required.`)},L.optional=(e,t)=>{e&&L(e,t)};function j(e){return f("Component",e),new w(e)}return j.create=(e,t,r)=>{rt(t),t.parent=e,t.render(r)},j.ensure=rt,j.is=yt,j.ensureType=L,j.props=St,j.json=mt,j});
