(function(c,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(c=typeof globalThis<"u"?globalThis:c||self,c.com=l())})(this,function(){var U,M,A,K,_,L,C,I,R,j,D,p,F,J,et,q,E,X,a,S,w,g,H,W,z,m,N,T,Y,pt,B,nt;"use strict";var gt=Object.defineProperty;var Ot=(c,l,h)=>l in c?gt(c,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):c[l]=h;var at=(c,l,h)=>(Ot(c,typeof l!="symbol"?l+"":l,h),h),tt=(c,l,h)=>{if(!l.has(c))throw TypeError("Cannot "+h)};var i=(c,l,h)=>(tt(c,l,"read from private field"),h?h.call(c):l.get(c)),o=(c,l,h)=>{if(l.has(c))throw TypeError("Cannot add the same private member more than once");l instanceof WeakSet?l.add(c):l.set(c,h)},u=(c,l,h,O)=>(tt(c,l,"write to private field"),O?O.call(c,h):l.set(c,h),h);var $=(c,l,h)=>(tt(c,l,"access private method"),h);function c(e,t){if(typeof t!="object"||t==null||!Array.isArray(t))throw new Error(`${e} is ${typeof t} and not a valid array.`)}function l(e,t){if(typeof t!="function"||t==null)throw new Error(`${e} is ${typeof t} and not a valid function.`)}function h(e,t){if(typeof t!="object"||t==null||Array.isArray(t))throw new Error(`${e} is ${typeof t} and not a valid object.`)}function O(e,t){if(typeof t!="string"&&!(t instanceof String)||t==null)throw new Error(`${e} is ${typeof t} and not a valid string.`)}function x(e){return typeof e=="object"&&e!=null&&Array.isArray(e)}function dt(e){return typeof e=="function"&&e!=null}function G(e){return typeof e=="object"&&e!=null&&!Array.isArray(e)}function Q(e){return(typeof e=="string"||e instanceof String)&&e!=null}const it=[],st="_xso_com_",d={COMPONENTS:it,COMPONENTS_PREFIX:st,getComponent:e=>it.find(t=>t.key==e).instance,isKey:e=>e.indexOf(st)==0};class Z{constructor(t,r){o(this,U,null);o(this,M,null);o(this,A,null);o(this,K,null);u(this,U,t),u(this,M,r)}get current(){return i(this,K)}set current(t){u(this,K,t),i(this,M).fire(this)}set(t){return u(this,A,t),this}get(){return i(this,A)}}U=new WeakMap,M=new WeakMap,A=new WeakMap,K=new WeakMap,Z.prototype.toString=function(){return this.current};function yt(e,t){h("Properties",t);const r=s=>new Error(`Content of type ${typeof s} is not valid, only string, object, or array with objects.`);for(const s of Object.keys(t)){const n=t[s];if(s=="_"&&n)if(Q(n))e.textContent=n;else if(x(n))v(e,n);else if(G(n))v(e,[n]);else throw r(n);else if(s=="$"&&n)if(Q(n))e.innerHTML=n;else if(x(n))v(e,n);else if(G(n))v(e,[n]);else throw r(n);else if(s=="text"&&n)O(s,n),e.innerText=n;else if(s=="html"&&n)O(s,n),e.innerHTML=n;else if(s=="style"&&n){h(s,n);for(const f of Object.keys(n))e.style[f]=n[f]}else if(s=="className"&&n)O(s,n),e.className=n;else if(s=="classList"&&n)rt(e,n);else if(s=="class"&&n){if(Q(n))e.className=n;else if(x(n))rt(e,n);else if(n!=null&&n!=null)throw new Error(`CSS Class of type ${typeof n} is not valid, only string or array of strings is accepted.`)}else s.indexOf("on")==0?(l(s,n),e.addEventListener(s.substring(2).toLowerCase(),n)):e.setAttribute(s,n)}}function rt(e,t){c(key,t);for(const r of t)O(r),e.classList.add(r)}function v(e,t,r){const s=[];if(G(t))if(t instanceof Z){const n=v(e,t.get());if(n.length==0)throw new Error("Reference is empty with no valid elements.");if(n.length>1)throw new Error("Reference with more than 1 element.");t.current=n[0]}else{const n=Object.keys(t);if(n.length>1)throw new Error(`Object with more than 1 keys: ${n.join(", ")}`);if(n.length==0)throw new Error("Object with no key, but one is required.");for(const f of n){const ft=t[f];if(f.indexOf("_")!=0){const k=document.createElement(f);yt(k,ft),s.push(k),e.appendChild(k)}else if(d.isKey(f)){const k=d.getComponent(f).clone();k.parent=e,k.render(ft),s.push(k)}}}else if(x(t))for(const n of t)if(Q(n)){const f=document.createTextNode(n);e.appendChild(f),s.push(n)}else v(e,n);else throw new Error(`View of type ${typeof t} is invalid, only object or array of objects.`);return s}class ot{constructor(t,r){o(this,_,null);o(this,L,null);o(this,C,null);o(this,I,null);u(this,_,t),u(this,C,r)}set val(t){JSON.stringify(i(this,I))!=JSON.stringify(t)&&(u(this,L,i(this,C)),u(this,C,t),u(this,I,JSON.stringify(t)),console.log("Props >> "+i(this,_).key(),t))}get val(){return i(this,C)}get previous(){return i(this,L)}}_=new WeakMap,L=new WeakMap,C=new WeakMap,I=new WeakMap,ot.prototype.toString=function(){return this.val};class lt{constructor(t,r,s){o(this,J);o(this,R,null);o(this,j,null);o(this,D,null);o(this,p,null);o(this,F,0);u(this,R,t),u(this,j,r),u(this,p,s)}set $val(t){i(this,p)!==t&&($(this,J,et).call(this,t),i(this,R).render(),i(this,j).fire(this))}get $val(){return i(this,p)}set val(t){i(this,p)!==t&&($(this,J,et).call(this,t),i(this,j).fire(this))}get val(){return i(this,p)}get previous(){return i(this,D)}get lastChanged(){return i(this,F)}}R=new WeakMap,j=new WeakMap,D=new WeakMap,p=new WeakMap,F=new WeakMap,J=new WeakSet,et=function(t){u(this,D,i(this,p)),u(this,p,t),u(this,F,Date.now())},lt.prototype.toString=function(){return this.val};class mt{constructor(){o(this,q,[]);o(this,E,[])}add(t,r){i(this,q).push({items:t,func:r})}fire(t){const r=i(this,q).filter(s=>s.items.includes(t));for(const s of r)s&&!i(this,E).includes(s.func)&&(i(this,E).push(s.func),setTimeout(()=>{i(this,E).splice(i(this,E).indexOf(s.func),1),s.func()},0))}}q=new WeakMap,E=new WeakMap;const V=class{constructor(t){o(this,Y);o(this,B);o(this,X,!1);o(this,a,null);o(this,S,null);o(this,w,null);o(this,g,null);o(this,H,[]);o(this,W,()=>{});o(this,z,()=>{});o(this,m,[]);o(this,N,new mt);at(this,"parent",null);o(this,T,null);if(!dt(t)||t.toString().indexOf("function")!=0)throw new Error("Only classic functions are used for components and arrow function is not supported.");u(this,a,t),$(this,Y,pt).call(this)}name(){return i(this,a).name}clone(){return new V(i(this,a))}destroy(t){u(this,W,t)}view(t){u(this,z,t)}ref(){return new Z(this,i(this,N))}changes(t,r){i(this,N).add(t,r)}render(t){var s;const r=this;i(this,w)?(i(this,T)&&clearTimeout(i(this,T)),u(this,T,setTimeout(()=>{var n;$(n=r,B,nt).call(n,t)},0))):$(s=r,B,nt).call(s,t)}static isSameKind(t,r){let s=null;for(const f of Object.keys(t))s=f;const n=d.getComponent(s);return i(n,a)===i(r,a)}function(){return i(this,a)}key(){return i(this,S)}destroy(){const t=d.COMPONENTS.findIndex(r=>r.key==i(this,S));d.COMPONENTS.splice(t,1)}state(t){if(i(this,g))return i(this,H)[i(this,g).state++];const r=new lt(this,i(this,N),t);return i(this,H).push(r),r}};let y=V;X=new WeakMap,a=new WeakMap,S=new WeakMap,w=new WeakMap,g=new WeakMap,H=new WeakMap,W=new WeakMap,z=new WeakMap,m=new WeakMap,N=new WeakMap,T=new WeakMap,Y=new WeakSet,pt=function(){for(;;){const t=d.COMPONENTS_PREFIX+"["+i(this,a).name+"]_"+(Math.random()+1).toString(36).substring(2);if(!d.COMPONENTS.find(r=>r.key==t)){u(this,S,t);break}}d.COMPONENTS.push({key:i(this,S),instance:this})},B=new WeakSet,nt=function(t){i(this,w)?t?i(this,w).val=t:u(this,g,{state:0}):u(this,w,new ot(this,t)),i(this,X)==!1&&(i(this,a).bind(this)(i(this,w).val),u(this,X,!0));let r=i(this,z).bind(this)();(!r||r.length==0)&&(r=[{span:{style:{display:"none"}}}]);const s=document.createDocumentFragment();if(v(s,r),i(this,g)){const n=[];for(const f of s.children)n.push(f);if(i(this,m).length==0)this.parent.appendChild(s);else{parent=i(this,m)[0].parentNode,parent.insertBefore(s,i(this,m)[0]);for(const f of i(this,m))parent.removeChild(f)}u(this,m,n)}else{for(const n of s.children)i(this,m).push(n);this.parent.appendChild(s)}u(this,g,null)},y.prototype.toString=function(){return this.key()},y.prototype.isSameKind=function(e,t){return y.isSameKind(e,t)};function ct(e){return e instanceof y}function ut(e){if(!ct(e))throw new Error("Invalid component, because not implement the component class.")}function wt(e){h("Component Props",e);let t=null;for(const r of Object.keys(e)){if(t!=null)throw new Error(`More than 1 component in the same object: ${e}`);t=e[r],h("Component Props Loaded",t)}return t}function ht(e){h("jsonDefinition of an invalid object.",e);let t=null;for(const s of Object.keys(e))t=s;let r=t;return t.indexOf(d.COMPONENTS_PREFIX)==0&&(r=t.substring(t.indexOf("[")+1,t.lastIndexOf("]"))),JSON.stringify({[r]:e[t]})}function P(e,t){const r=s=>new Error(`Only ${t.function().name} type is accepted! This component is invalid: ${ht(s)}`);if(x(e)){for(const s of e)if(h("ensureSameKind of an invalid object.",s),!y.isSameKind(s,t))throw r(s)}else if(G(e)){if(!y.isSameKind(e,t))throw r(e)}else throw new Error("Invalid kind.")}P.required=(e,t)=>{if(e)return P(e,t);throw new Error(`${t.name()} is required.`)},P.optional=(e,t)=>{e&&P(e,t)};function b(e){return l("Component",e),new y(e)}return b.create=(e,t,r)=>{ut(t),t.parent=e,t.render(r)},b.ensure=ut,b.is=ct,b.ensureType=P,b.props=wt,b.json=ht,b});
